<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>QR s odkazy na Google Disk</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        #qrcode img {
            border: 1px solid #ccc;
            padding: 10px;
        }
    </style>
</head>
<body>
    <h1>QR kód s odkazy na Google Disk</h1>

    <label for="g1">Google Disk - nápojový lístek (ID nebo celé URL):</label>
    <input type="text" id="g1" style="width: 100%;" placeholder="1abcDEFghiJKlmnOpqRSTuvwXYZ"><br><br>

    <label for="g2">Google Disk - lineup festivalu:</label>
    <input type="text" id="g2" style="width: 100%;" placeholder="1def456UVWxyz789LMNOPqrs"><br><br>

    <button onclick="generateQR()">Generovat QR kód</button>

    <div id="qrcode" style="margin-top: 20px;"></div>

    <script>
        function extractId(input) {
            // Pokud zadal celé URL, vytáhneme ID
            const match = input.match(/[-\w]{25,}/);
            return match ? match[0] : input;
        }

        function generateQR() {
            const raw1 = document.getElementById('g1').value.trim();
            const raw2 = document.getElementById('g2').value.trim();

            const id1 = extractId(raw1);
            const id2 = extractId(raw2);

            if (!id1 || !id2) {
                alert("Zadej obě ID nebo URL!");
                return;
            }

            const url1 = `https://drive.google.com/uc?export=view&id=${id1}`;
            const url2 = `https://drive.google.com/uc?export=view&id=${id2}`;

            const data = {
                napojovy_listek_url: url1,
                lineup_url: url2
            };

            const json = JSON.stringify(data);
            const encoded = encodeURIComponent(json);
            const fullUrl = window.location.origin + window.location.pathname + "?data=" + encoded;

            document.getElementById('qrcode').innerHTML = "";
            new QRCode(document.getElementById("qrcode"), {
                text: fullUrl,
                width: 256,
                height: 256,
                correctLevel: QRCode.CorrectLevel.H
            });

            console.log("QR obsahuje:", fullUrl);
        }
    </script>
</body>
</html>
