<!DOCTYPE html>
<html>
<head>
    <title>QR kód pro festival</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        textarea { width: 100%; height: 150px; }
        .qr-result { margin-top: 30px; text-align: center; }
        #qrcode { margin: 20px auto; }
        #qrcode img { margin: 0 auto; }
        button { background-color: #4CAF50; color: white; padding: 10px 15px; border: none; cursor: pointer; }
        .instructions { margin-top: 30px; border-top: 1px solid #ccc; padding-top: 20px; }
        .tab-container { margin-top: 20px; }
        .tab-buttons { display: flex; }
        .tab-button { padding: 10px 15px; background-color: #f1f1f1; border: none; cursor: pointer; margin-right: 2px; }
        .tab-button.active { background-color: #4CAF50; color: white; }
        .tab-content { display: none; padding: 20px; border: 1px solid #ddd; }
        .tab-content.active { display: block; }
        .download-link { display: inline-block; margin-top: 10px; padding: 8px 15px; background-color: #007BFF; color: white; text-decoration: none; }
        .warning { background-color: #fff3cd; padding: 10px; margin: 10px 0; border: 1px solid #ffeeba; }
    </style>
</head>
<body>
    <h1>QR kód pro festival</h1>
    
    <div class="warning">
        <p><strong>Pozor:</strong> Toto řešení generuje QR kódy s veškerými informacemi přímo v kódu. Funguje pro všechny běžné informace, ale velmi dlouhé texty mohou způsobit problémy.</p>
    </div>
    
    <div class="tab-container">
        <div class="tab-buttons">
            <button class="tab-button active" onclick="openTab('generator')">Generátor QR kódu</button>
            <button class="tab-button" onclick="openTab('viewer')">Zobrazení informací</button>
        </div>
        
        <div id="generator" class="tab-content active">
            <div class="form-group">
                <label for="napojovy_listek">Nápojový lístek:</label>
                <textarea id="napojovy_listek">Pivo:
- Pilsner Urquell 0,5l - 55 Kč
- Radegast 12° 0,5l - 50 Kč
- Kozel tmavý 0,5l - 45 Kč

Nealko:
- Voda (perlivá/neperlivá) 0,5l - 30 Kč
- Cola 0,5l - 45 Kč
- Džus 0,3l - 40 Kč</textarea>
            </div>
            
            <div class="form-group">
                <label for="lineup">Lineup festivalu:</label>
                <textarea id="lineup">Pátek:
15:00 - 16:00: DJ Franta
16:30 - 17:30: Local Heroes
18:00 - 19:30: Reggae Dub
20:00 - 21:30: Rock Stars
22:00 - 00:00: Headliner

Sobota:
14:00 - 15:00: Začínající kapela
15:30 - 16:30: Folková skupina
17:00 - 18:30: Indie Rock
19:00 - 20:30: Elektronika
21:00 - 23:00: Hlavní hvězda</textarea>
            </div>
            
            <button onclick="generateQR()">Generovat QR kód</button>
            
            <div class="qr-result">
                <div id="qrcode"></div>
                <div id="downloadContainer" style="display:none;">
                    <a id="downloadLink" href="#" download="festival_qr.png" class="download-link">Stáhnout QR kód</a>
                </div>
            </div>
            
            <div class="instructions">
                <h2>Návod k použití:</h2>
                <ol>
                    <li>Vyplňte nápojový lístek a lineup festivalu</li>
                    <li>Klikněte na tlačítko "Generovat QR kód"</li>
                    <li>Stáhněte si vygenerovaný QR kód</li>
                    <li>Vytiskněte QR kód a umístěte ho do propagačních materiálů</li>
                    <li>Při naskenování QR kódu se uživateli zobrazí informace</li>
                </ol>
            </div>
        </div>
        
        <div id="viewer" class="tab-content">
            <h2>Informace o festivalu</h2>
            <div id="viewerContent">
                <p>Pokud jste sem přišli ze skenu QR kódu, informace by se měly automaticky zobrazit.</p>
                <p>Pokud nevidíte žádné informace, kontaktujte organizátory festivalu.</p>
            </div>
        </div>
    </div>
    
    <script>
        // Otevření záložky
        function openTab(tabName) {
            var i, tabContent, tabButtons;
            
            // Skrytí všech záložek
            tabContent = document.getElementsByClassName("tab-content");
            for (i = 0; i < tabContent.length; i++) {
                tabContent[i].classList.remove("active");
            }
            
            // Odstranění aktivní třídy ze všech tlačítek
            tabButtons = document.getElementsByClassName("tab-button");
            for (i = 0; i < tabButtons.length; i++) {
                tabButtons[i].classList.remove("active");
            }
            
            // Zobrazení vybrané záložky a označení tlačítka jako aktivní
            document.getElementById(tabName).classList.add("active");
            event.currentTarget.classList.add("active");
            
            // Pokud je otevřena záložka pro prohlížení, zkontrolujeme URL parametry
            if (tabName === 'viewer') {
                checkUrlForData();
            }
        }
        
        // Funkce pro generování QR kódu
        function generateQR() {
            var napojovyListek = document.getElementById("napojovy_listek").value;
            var lineup = document.getElementById("lineup").value;
            
            // Vytvoření objektu s daty
            var data = {
                napojovy_listek: napojovyListek,
                lineup: lineup
            };
            
            // Komprese dat
            var jsonData = JSON.stringify(data);
            var compressedData = LZString.compressToEncodedURIComponent(jsonData);
            
            // Vytvoření URL s daty
            var baseUrl = window.location.href.split('?')[0]; // Získání základní URL bez parametrů
            var url = baseUrl + "?data=" + compressedData;
            
            // Nastavení velikosti QR kódu
            var size = 256;
            
            // Vymazání existujícího QR kódu
            document.getElementById("qrcode").innerHTML = "";
            
            // Vytvoření nového QR kódu
            var qrcode = new QRCode(document.getElementById("qrcode"), {
                text: url,
                width: size,
                height: size,
                colorDark: "#000000",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.H // Nejvyšší úroveň korekce chyb
            });
            
            // Zpřístupnění tlačítka pro stažení
            setTimeout(function() {
                var qrImage = document.querySelector("#qrcode img");
                if (qrImage) {
                    var downloadLink = document.getElementById("downloadLink");
                    downloadLink.href = qrImage.src;
                    document.getElementById("downloadContainer").style.display = "block";
                }
            }, 500);
        }
        
        // Funkce pro kontrolu URL a zobrazení dat
        function checkUrlForData() {
            var urlParams = new URLSearchParams(window.location.search);
            var compressedData = urlParams.get('data');
            
            if (compressedData) {
                try {
                    // Dekomprese dat
                    var jsonData = LZString.decompressFromEncodedURIComponent(compressedData);
                    var data = JSON.parse(jsonData);
                    
                    // Zobrazení dat na stránce
                    var viewerContent = document.getElementById("viewerContent");
                    viewerContent.innerHTML = `
                        <div class="section">
                            <h2>Nápojový lístek</h2>
                            <div class="menu">
                                ${data.napojovy_listek.replace(/\n/g, '<br>')}
                            </div>
                        </div>
                        
                        <div class="section">
                            <h2>Lineup festivalu</h2>
                            <div class="lineup">
                                ${data.lineup.replace(/\n/g, '<br>')}
                            </div>
                        </div>
                    `;
                    
                    // Automatické přepnutí na záložku "viewer"
                    openTab('viewer');
                } catch (e) {
                    console.error("Chyba při parsování dat:", e);
                }
            }
        }
        
        // Kontrola URL při načtení stránky
        window.onload = function() {
            checkUrlForData();
        };
    </script>
</body>
</html>